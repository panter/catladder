{"version":3,"sources":["../../src/actions/upload_server.js"],"names":[],"mappings":";;;;;;;;uBAAuB,UAAU;;;;6BAER,eAAe;;kCAEZ,wBAAwB;;iCACX,uBAAuB;;8BACxC,oBAAoB;;;;uBACxB,WAAW;;;;AAE/B,IAAM,UAAU,GAAG,iBAAiB,CAAC;;qBAGtB,UAAC,WAAW,EAAE,IAAI,EAAK;AACpC,MAAM,IAAI,GAAG,SAAP,IAAI;WAAS,0BAAQ,WAAW,EAAE,IAAI,CAAC;GAAA,CAAC;AAC9C,MAAM,MAAM,GAAG,mCAAW,UAAU,CAAC,CAAC;;AAEtC,MAAM,SAAS,GAAG,qCAAa,UAAU,EAAE,WAAW,CAAC,CAAC;AACxD,mEAA0C,WAAW,CAAG,CAAC;AACzD,MAAM,QAAQ,GAAG,qCAAY,EAAE,MAAM,EAAN,MAAM,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC,CAAC;AACtD,wCAAgB,QAAQ,oBAAe,SAAS,CAAC,IAAI,SAAI,SAAS,CAAC,IAAI,QAAK,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC;AAClG,2QASK,SAAS,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;CAC5C","file":"upload_server.js","sourcesContent":["import remoteExec from 'ssh-exec';\n\nimport { execSync } from 'child_process';\n\nimport { getBuildDir } from '../configs/directories';\nimport { getSshConfig, readConfig } from '../utils/config_utils';\nimport actionTitle from '../ui/action_title';\nimport restart from './restart';\n\nconst CONFIGFILE = '.catladder.yaml';\n\n\nexport default (environment, done) => {\n  const next = () => restart(environment, done);\n  const config = readConfig(CONFIGFILE);\n  // const envConf = config.environments[environment];\n  const sshConfig = getSshConfig(CONFIGFILE, environment);\n  actionTitle(`uploading server bundle to ${environment}`);\n  const buildDir = getBuildDir({ config, environment });\n  execSync(`scp ${buildDir}/app.tar.gz ${sshConfig.user}@${sshConfig.host}:`, { stdio: 'inherit' });\n  remoteExec(`\n      rm -rf ~/app/last\n      mv ~/app/bundle ~/app/last\n      rm ~/app/current\n      ln -s ~/app/bundle ~/app/current\n      tar xfz app.tar.gz -C app\n      pushd ~/app/bundle/programs/server\n      npm install\n      popd\n    `, sshConfig, next).pipe(process.stdout);\n};\n"]}