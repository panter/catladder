{"version":3,"sources":["../../src/commands/build_apps.js"],"names":[],"mappings":";;;;;;;;sBAAmB,QAAQ;;;;kBAEZ,IAAI;;;;kCAKZ,wBAAwB;;kCACuB,wBAAwB;;8BACzC,oBAAoB;;iCAC9B,uBAAuB;;8BAC1B,oBAAoB;;;;yCACT,6BAA6B;;;;sCACpC,4BAA4B;;;;kCAC3B,sBAAsB;;;;AAEnD,IAAM,UAAU,GAAG,iBAAiB,CAAC;;qBAGtB,UAAC,WAAW,EAAE,IAAI,EAAK;AACpC,MAAM,MAAM,GAAG,mCAAW,UAAU,CAAC,CAAC;AACtC,MAAM,QAAQ,GAAG,qCAAY,EAAE,MAAM,EAAN,MAAM,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC,CAAC;AACtD,6DAAoC,0CAAqB,WAAW,CAAC,CAAG,CAAC;AACzE,SAAO,CAAC,GAAG,iBAAe,QAAQ,CAAG,CAAC;;;;AAItC,MAAI,gBAAG,UAAU,CAAC,sDAA6B,EAAE,MAAM,EAAN,MAAM,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC,CAAC,EAAE;AACxE,wBAAO,IAAI,CAAC,sDAA6B,EAAE,MAAM,EAAN,MAAM,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC,CAAC,CAAC;GACpE;AACD,MAAI,gBAAG,UAAU,CAAC,kDAAyB,EAAE,MAAM,EAAN,MAAM,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC,CAAC,EAAE;AACpE,wBAAO,IAAI,CAAC,kDAAyB,EAAE,MAAM,EAAN,MAAM,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC,CAAC,CAAC;GAChE;;AAED,2CAAgB,EAAE,MAAM,EAAN,MAAM,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC,CAAC;;;AAGzC,uCAAiB,WAAW,EAAE,MAAM,CAAC,CAAC;;;AAGtC,MAAI,gBAAG,UAAU,CAAC,4CAAmB,EAAE,MAAM,EAAN,MAAM,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC,CAAC,EAAE;AAC9D,gDAAuB,WAAW,EAAE,IAAI,CAAC,CAAC;GAC3C,MAAM;AACL,QAAI,CAAC,IAAI,uBAAqB,QAAQ,CAAG,CAAC;GAC3C;CACF","file":"build_apps.js","sourcesContent":["import rimraf from 'rimraf';\n\nimport fs from 'fs';\n\nimport {\n  getAndroidBuildDir,\n  getAndroidBuildProjectFolder,\n} from '../build/android_build';\nimport { getBuildDir, getIosBuildProjectFolder } from '../configs/directories';\nimport { getFullVersionString } from '../utils/git_utils';\nimport { readConfig } from '../utils/config_utils';\nimport actionTitle from '../ui/action_title';\nimport androidPrepareForStore from './android_prepare_for_store';\nimport execMeteorBuild from '../build/exec_meteor_build';\nimport iosRevealProject from './ios_reveal_project';\n\nconst CONFIGFILE = '.catladder.yaml';\n\n\nexport default (environment, done) => {\n  const config = readConfig(CONFIGFILE);\n  const buildDir = getBuildDir({ config, environment });\n  actionTitle(`building mobile apps ${getFullVersionString(environment)}`);\n  console.log(`build dir: ${buildDir}`);\n\n  // remove project folders if existing\n  // otherwise apps might get bloated with old code\n  if (fs.existsSync(getAndroidBuildProjectFolder({ config, environment }))) {\n    rimraf.sync(getAndroidBuildProjectFolder({ config, environment }));\n  }\n  if (fs.existsSync(getIosBuildProjectFolder({ config, environment }))) {\n    rimraf.sync(getIosBuildProjectFolder({ config, environment }));\n  }\n\n  execMeteorBuild({ config, environment });\n\n  // open ios project if exists\n  iosRevealProject(environment, config);\n\n  // init android if it exists\n  if (fs.existsSync(getAndroidBuildDir({ config, environment }))) {\n    androidPrepareForStore(environment, done);\n  } else {\n    done(null, `apps created in ${buildDir}`);\n  }\n};\n"]}