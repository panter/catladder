{"version":3,"sources":["../../../src/deployments/panter-meteor-classic/push.js"],"names":[],"mappings":";;;;;;;;uBAAuB,UAAU;;;;kCAEL,2BAA2B;;iCACd,0BAA0B;;8BAC3C,uBAAuB;;;;yBAC9B,kBAAkB;;;;AAEnC,IAAM,UAAU,GAAG,iBAAiB,CAAC;;qBAEtB,UAAC,WAAW,EAAE,IAAI,EAAK;AACpC,MAAM,MAAM,GAAG,oCAAY,CAAC;;;AAG5B,MAAM,SAAS,GAAG,qCAAa,UAAU,EAAE,WAAW,CAAC,CAAC;AACxD,mEAA0C,WAAW,CAAG,CAAC;AACzD,MAAM,QAAQ,GAAG,qCAAY,EAAE,MAAM,EAAN,MAAM,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC,CAAC;AACtD,uCAAY,QAAQ,oBAAe,SAAS,CAAC,IAAI,SAAI,SAAS,CAAC,IAAI,QAAK,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC;AAC9F,2QAWE,SAAS,EACT,IAAI,CACL,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;CACxB","file":"push.js","sourcesContent":["import remoteExec from 'ssh-exec';\n\nimport { getBuildDir } from '../../configs/directories';\nimport { getSshConfig, readConfig } from '../../utils/config_utils';\nimport actionTitle from '../../ui/action_title';\nimport exec from '../../utils/exec';\n\nconst CONFIGFILE = '.catladder.yaml';\n\nexport default (environment, done) => {\n  const config = readConfig();\n\n  // const envConf = config.environments[environment];\n  const sshConfig = getSshConfig(CONFIGFILE, environment);\n  actionTitle(`uploading server bundle to ${environment}`);\n  const buildDir = getBuildDir({ config, environment });\n  exec(`scp ${buildDir}/app.tar.gz ${sshConfig.user}@${sshConfig.host}:`, { stdio: 'inherit' });\n  remoteExec(\n    `\n      rm -rf ~/app/last\n      mv ~/app/bundle ~/app/last\n      rm ~/app/current\n      ln -s ~/app/bundle ~/app/current\n      tar xfz app.tar.gz -C app\n      pushd ~/app/bundle/programs/server\n      npm install\n      popd\n    `,\n    sshConfig,\n    done,\n  ).pipe(process.stdout);\n};\n"]}