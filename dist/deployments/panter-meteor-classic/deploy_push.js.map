{"version":3,"sources":["../../../src/deployments/panter-meteor-classic/deploy_push.js"],"names":[],"mappings":";;;;;;;;6BAAyB,eAAe;;uBAEjB,UAAU;;;;kCAEL,2BAA2B;;iCACd,0BAA0B;;8BAC3C,uBAAuB;;;;AAE/C,IAAM,UAAU,GAAG,iBAAiB,CAAC;;qBAEtB,UAAC,WAAW,EAAE,IAAI,EAAK;AACpC,QAAM,MAAM,GAAG,oCAAY,CAAC;;;AAG5B,QAAM,SAAS,GAAG,qCAAa,UAAU,EAAE,WAAW,CAAC,CAAC;AACxD,qEAA0C,WAAW,CAAG,CAAC;AACzD,QAAM,QAAQ,GAAG,qCAAY,EAAE,MAAM,EAAN,MAAM,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC,CAAC;AACtD,0CAAgB,QAAQ,oBAAe,SAAS,CAAC,IAAI,SAAI,SAAS,CAAC,IAAI,QAAK,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC;AAClG,6QASK,SAAS,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;CAC5C","file":"deploy_push.js","sourcesContent":["import { execSync } from 'child_process';\n\nimport remoteExec from 'ssh-exec';\n\nimport { getBuildDir } from '../../configs/directories';\nimport { getSshConfig, readConfig } from '../../utils/config_utils';\nimport actionTitle from '../../ui/action_title';\n\nconst CONFIGFILE = '.catladder.yaml';\n\nexport default (environment, done) => {\n  const config = readConfig();\n\n  // const envConf = config.environments[environment];\n  const sshConfig = getSshConfig(CONFIGFILE, environment);\n  actionTitle(`uploading server bundle to ${environment}`);\n  const buildDir = getBuildDir({ config, environment });\n  execSync(`scp ${buildDir}/app.tar.gz ${sshConfig.user}@${sshConfig.host}:`, { stdio: 'inherit' });\n  remoteExec(`\n      rm -rf ~/app/last\n      mv ~/app/bundle ~/app/last\n      rm ~/app/current\n      ln -s ~/app/bundle ~/app/current\n      tar xfz app.tar.gz -C app\n      pushd ~/app/bundle/programs/server\n      npm install\n      popd\n    `, sshConfig, done).pipe(process.stdout);\n};\n"]}